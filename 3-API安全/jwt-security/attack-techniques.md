

### JWT令牌安全攻击技术详解（Web安全方向）

JSON Web Token（JWT）是广泛应用于Web身份验证和授权的开放标准（RFC 7519）。其结构由 **Header**、**Payload** 和 **Signature** 三部分组成，通过Base64URL编码后以点分隔。尽管JWT设计具备安全性，但实现或配置不当可能导致严重漏洞。以下从Web安全角度解析JWT的常见攻击手法及利用方式。

---

### 一、算法篡改攻击（Algorithm Manipulation）

#### 1. **"none"算法绕过**
- **原理**：JWT头部声明签名算法（`alg`字段）。若服务端支持`alg=none`（表示无签名验证），攻击者可篡改`alg`为`none`并删除签名部分，伪造任意令牌。
- **利用方式**：
  ```json
  // 原始Header
  {"alg": "HS256", "typ": "JWT"}
  
  // 篡改后
  {"alg": "none", "typ": "JWT"}
  ```
  移除签名部分（保留末尾的点），服务端可能直接信任未经验证的Payload。

#### 2. **算法混淆（HS256/RS256混淆）**
- **原理**：服务端若错误配置算法验证逻辑（如强制使用HS256但实际依赖RS256的公钥体系），攻击者可构造冲突。例如，当服务端使用RS256的公钥作为HS256的密钥时，攻击者可通过公钥计算有效HMAC签名。
- **利用方式**：
  1. 获取服务端RS256公钥（可能通过`/.well-known/jwks.json`或错误信息暴露）。
  2. 修改Header为`{"alg": "HS256"}`。
  3. 使用公钥作为HS256密钥生成签名，伪造令牌。

---

### 二、签名验证缺失
- **原理**：部分应用未对JWT签名进行验证，直接解析Header和Payload。攻击者可任意修改Payload内容（如提升权限、篡改用户ID）。
- **案例**：修改Payload中的`"role": "user"`为`"role": "admin"`，跳过签名验证直接生效。

---

### 三、密钥爆破（Secret Brute-Forcing）
- **原理**：若JWT使用弱密钥（如短密码、常见单词）进行HS256签名，攻击者可通过字典攻击或暴力破解获取密钥。
- **工具**：使用`hashcat`或`jwt_tool`进行爆破：
  ```bash
  jwt_tool <token> -C -d wordlist.txt
  ```
- **防御关键**：使用强随机密钥（≥256位）并定期更换。

---

### 四、敏感信息泄露
- **原理**：JWT的Payload仅经Base64编码，未加密。若包含敏感数据（如密码、密钥片段），可能被中间人攻击或客户端存储泄露（如浏览器LocalStorage）。
- **案例**：通过拦截HTTP流量或XSS攻击窃取JWT，解码后获取用户隐私信息。

---

### 五、过期时间篡改（Expiration Bypass）
- **原理**：服务端若未校验`exp`（过期时间）或`nbf`（生效时间），攻击者可修改`exp`为未来时间，使令牌永久有效。
- **Payload示例**：
  ```json
  {"sub": "user123", "exp": 1893456000}  // 2030年过期
  ```

---

### 六、JWT头部参数注入
JWT头部支持多个扩展参数，攻击者可利用其逻辑缺陷。

#### 1. **kid（Key ID）注入**
- **原理**：`kid`用于指定验签密钥的标识。若服务端通过`kid`动态选择密钥（如从数据库或文件系统加载），攻击者可指向恶意密钥。
- **利用方式**：
  ```json
  {
    "alg": "HS256",
    "kid": "../../../../../etc/passwd"  // 路径遍历加载系统文件
  }
  ```

#### 2. **jku/jwk参数劫持**
- **原理**：`jku`（JWK Set URL）声明公钥地址，`jwk`直接嵌入公钥。若服务端信任外部`jku`或未校验`jwk`来源，攻击者可伪造公钥。
- **利用方式**：
  1. 托管恶意JWK Set文件（包含攻击者公钥）。
  2. 构造JWT头部包含`"jku": "http://attacker.com/key.json"`，使服务端使用攻击者公钥验证签名。

---

### 七、跨服务中继攻击（Cross-Service Relay）
- **原理**：同一JWT在多个服务间共享且验签密钥相同时，攻击者可在低权限服务获取令牌，用于高权限服务。
- **案例**：在博客系统获取的JWT被用于访问管理后台，绕过权限控制。

---

### 八、XSS与JWT结合攻击
- **原理**：通过XSS漏洞窃取客户端存储的JWT（如LocalStorage），直接劫持会话。
- **增强利用**：结合CORS配置错误，通过恶意脚本跨域发送携带JWT的请求。

---

### 九、其他攻击场景
#### 1. **密钥复用**
  若多个服务共用同一密钥签发JWT，攻击者可在一个服务生成令牌后，在另一服务重放。

#### 2. **嵌套令牌（JWE）破解**
  嵌套加密的JWE（JWT加密结构）若使用弱算法（如AES-CBC），可能被预测IV或密钥复用攻击破解。

---

### 防御措施概览
1. **严格校验算法**：禁用`none`算法，固定`alg`字段值，避免算法混淆。
2. **强密钥管理**：使用高熵密钥，定期轮换，隔离不同服务密钥。
3. **全参数验证**：校验`exp`、`nbf`、`iss`（签发者）、`aud`（受众）等字段。
4. **头部限制**：禁止动态加载外部密钥（如`jku`、`jwk`），过滤`kid`路径遍历。
5. **安全存储**：避免客户端存储敏感JWT，优先使用HttpOnly Cookie传输。
6. **依赖库更新**：使用最新JWT库（如`jsonwebtoken`），避免已知漏洞。

---

### 总结
JWT的安全性高度依赖开发者的配置和代码实现。攻击者常利用算法逻辑缺陷、密钥管理疏漏及验证缺失实施攻击。通过严格遵循RFC规范、全面验证令牌字段、隔离密钥使用环境，可有效降低风险。安全团队需结合自动化工具（如`jwt_tool`、Burp JWT插件）进行渗透测试，持续监控令牌生命周期。

---

*文档生成时间: 2025-03-13 12:56:13*












